<?xml version="1.0" encoding="UTF-8"?>
<!-- Configures the Camel Context-->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:camel="http://camel.apache.org/schema/spring"
       xmlns:cxf="http://camel.apache.org/schema/cxf"
       xmlns:jaxrs="http://cxf.apache.org/jaxrs"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/cxf http://camel.apache.org/schema/cxf/camel-cxf.xsd
       http://cxf.apache.org/jaxrs http://cxf.apache.org/schemas/jaxrs.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">

 <!-- Defined the real JAXRS back end service  -->
  <jaxrs:server id="restService"
                address="http://localhost:9091/rest" 
                staticSubresourceResolution="true">
    <jaxrs:serviceBeans>
      <ref bean="backendRESTService"/>
    </jaxrs:serviceBeans>       
  </jaxrs:server>
  
  <bean id="backendRESTService" class="com.mycompany.camel.spring.BackendRESTService" />
  
<cxf:rsServer id="restFrontend" address="http://localhost:9090/route" serviceClass="com.mycompany.camel.spring.FrontendRESTService"/>
<cxf:rsClient id="restBackend" address="http://localhost:9091/rest" serviceClass="com.mycompany.camel.spring.BackendRESTService"/>

<cxf:cxfEndpoint id="backendSOAPService"
                   address="http://localhost:9092/backendsoapservice"
                   endpointName="s:BackendSOAPPort"
                   serviceName="s:BackendSOAPServiceService"
                   serviceClass="com.mycompany.camel.spring.BackendSOAPServicePortType"
                   wsdlURL="etc/BackendSOAPService.wsdl"
                   xmlns:s="http://spring.camel.mycompany.com">
    	<!-- cxf:properties>
	        <entry key="dataFormat" value="CXF_MESSAGE"/>
	    </cxf:properties-->
    </cxf:cxfEndpoint>
    
 <bean id="realSOAPService" class="com.mycompany.camel.spring.RealSOAPServiceBean"
        init-method="start" destroy-method="stop">
    	<!-- url of the real web service we have proxied -->
    	<property name="url" value="http://localhost:9092/backendsoapservice"/>
  	</bean>
  	
  	<bean id="soapProcessor" class="com.mycompany.camel.spring.SOAPProcessor"></bean>

  <camelContext xmlns="http://camel.apache.org/schema/spring">
    <route>
        <from uri="cxfrs:bean:restFrontend"/>
        <to uri="cxfrs:bean:restBackend"/>
        <process ref="soapProcessor"/>
        <to uri="cxf:bean:backendSOAPService?dataFormat=MESSAGE"/>
    </route>
</camelContext>

</beans>
